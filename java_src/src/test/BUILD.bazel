load("//tools:gen_java_test_rules.bzl", "gen_java_test_rules")

licenses(["notice"])

java_library(
    name = "generator_test",
    testonly = 1,
    srcs = glob([
        "**/*.java",
    ]),
    deps = [
        "//proto:aes_cmac_java_proto",
        "//proto:aes_ctr_hmac_aead_java_proto",
        "//proto:aes_ctr_hmac_streaming_java_proto",
        "//proto:aes_ctr_java_proto",
        "//proto:aes_eax_java_proto",
        "//proto:aes_gcm_hkdf_streaming_java_proto",
        "//proto:aes_gcm_java_proto",
        "//proto:aes_siv_java_proto",
        "//proto:chacha20_poly1305_java_proto",
        "//proto:common_java_proto",
        "//proto:config_java_proto",
        "//proto:ecdsa_java_proto",
        "//proto:ecies_aead_hkdf_java_proto",
        "//proto:ed25519_java_proto",
        "//proto:hkdf_prf_java_proto",
        "//proto:hmac_java_proto",
        "//proto:kms_aead_java_proto",
        "//proto:kms_envelope_java_proto",
        "//proto:prf_based_deriver_java_proto",
        "//proto:rsa_ssa_pkcs1_java_proto",
        "//proto:rsa_ssa_pss_java_proto",
        "//proto:tink_java_proto",
        "//proto:xchacha20_poly1305_java_proto",
        "//src/main/java/com/google/crypto/tink:aead",
        "//src/main/java/com/google/crypto/tink:binary_keyset_reader",
        "//src/main/java/com/google/crypto/tink:binary_keyset_writer",
        "//src/main/java/com/google/crypto/tink:catalogue",
        "//src/main/java/com/google/crypto/tink:cleartext_keyset_handle",
        "//src/main/java/com/google/crypto/tink:config",
        "//src/main/java/com/google/crypto/tink:core",
        "//src/main/java/com/google/crypto/tink:crypto_format",
        "//src/main/java/com/google/crypto/tink:deterministic_aead",
        "//src/main/java/com/google/crypto/tink:hybrid_decrypt",
        "//src/main/java/com/google/crypto/tink:hybrid_encrypt",
        "//src/main/java/com/google/crypto/tink:json_keyset_reader",
        "//src/main/java/com/google/crypto/tink:json_keyset_writer",
        "//src/main/java/com/google/crypto/tink:key_manager",
        "//src/main/java/com/google/crypto/tink:key_manager_impl",
        "//src/main/java/com/google/crypto/tink:key_template",
        "//src/main/java/com/google/crypto/tink:key_type_manager",
        "//src/main/java/com/google/crypto/tink:key_wrap",
        "//src/main/java/com/google/crypto/tink:keyset_reader",
        "//src/main/java/com/google/crypto/tink:keyset_writer",
        "//src/main/java/com/google/crypto/tink:kms_client",
        "//src/main/java/com/google/crypto/tink:kms_clients",
        "//src/main/java/com/google/crypto/tink:mac",
        "//src/main/java/com/google/crypto/tink:no_secret_keyset_handle",
        "//src/main/java/com/google/crypto/tink:primitive_set",
        "//src/main/java/com/google/crypto/tink:primitive_wrapper",
        "//src/main/java/com/google/crypto/tink:private_key_manager",
        "//src/main/java/com/google/crypto/tink:private_key_manager_impl",
        "//src/main/java/com/google/crypto/tink:private_key_type_manager",
        "//src/main/java/com/google/crypto/tink:public_key_sign",
        "//src/main/java/com/google/crypto/tink:public_key_verify",
        "//src/main/java/com/google/crypto/tink:registry_cluster",
        "//src/main/java/com/google/crypto/tink:streaming_aead",
        "//src/main/java/com/google/crypto/tink:util",
        "//src/main/java/com/google/crypto/tink/aead:aead_config",
        "//src/main/java/com/google/crypto/tink/aead:aead_key_templates",
        "//src/main/java/com/google/crypto/tink/aead:aead_wrapper",
        "//src/main/java/com/google/crypto/tink/aead:aes_ctr_hmac_aead_key_manager",
        "//src/main/java/com/google/crypto/tink/aead:aes_ctr_key_manager",
        "//src/main/java/com/google/crypto/tink/aead:aes_eax_key_manager",
        "//src/main/java/com/google/crypto/tink/aead:aes_gcm_key_manager",
        "//src/main/java/com/google/crypto/tink/aead:cha_cha20_poly1305_key_manager",
        "//src/main/java/com/google/crypto/tink/aead:kms_aead_key_manager",
        "//src/main/java/com/google/crypto/tink/aead:kms_envelope_aead_key_manager",
        "//src/main/java/com/google/crypto/tink/aead:x_cha_cha20_poly1305_key_manager",
        "//src/main/java/com/google/crypto/tink/aead/subtle:aead_factory",
        "//src/main/java/com/google/crypto/tink/aead/subtle:aes_gcm_factory",
        "//src/main/java/com/google/crypto/tink/config:tink_config",
        "//src/main/java/com/google/crypto/tink/daead:aes_siv_key_manager",
        "//src/main/java/com/google/crypto/tink/daead:deterministic_aead_config",
        "//src/main/java/com/google/crypto/tink/daead:deterministic_aead_factory",
        "//src/main/java/com/google/crypto/tink/daead:deterministic_aead_key_templates",
        "//src/main/java/com/google/crypto/tink/daead:deterministic_aead_wrapper",
        "//src/main/java/com/google/crypto/tink/hybrid:ecies_aead_hkdf_private_key_manager",
        "//src/main/java/com/google/crypto/tink/hybrid:ecies_aead_hkdf_public_key_manager",
        "//src/main/java/com/google/crypto/tink/hybrid:hybrid_config",
        "//src/main/java/com/google/crypto/tink/hybrid:hybrid_decrypt_factory",
        "//src/main/java/com/google/crypto/tink/hybrid:hybrid_decrypt_wrapper",
        "//src/main/java/com/google/crypto/tink/hybrid:hybrid_encrypt_factory",
        "//src/main/java/com/google/crypto/tink/hybrid:hybrid_encrypt_wrapper",
        "//src/main/java/com/google/crypto/tink/hybrid:hybrid_key_templates",
        "//src/main/java/com/google/crypto/tink/hybrid:hybrid_util",
        "//src/main/java/com/google/crypto/tink/hybrid:registry_ecies_aead_hkdf_dem_helper",
        "//src/main/java/com/google/crypto/tink/hybrid/subtle:rsa_kem",
        "//src/main/java/com/google/crypto/tink/hybrid/subtle:rsa_kem_hybrid_decrypt",
        "//src/main/java/com/google/crypto/tink/hybrid/subtle:rsa_kem_hybrid_encrypt",
        "//src/main/java/com/google/crypto/tink/integration/awskms:aws_kms_aead",
        "//src/main/java/com/google/crypto/tink/integration/gcpkms:gcp_kms_client",
        "//src/main/java/com/google/crypto/tink/mac:aes_cmac_key_manager",
        "//src/main/java/com/google/crypto/tink/mac:hmac_key_manager",
        "//src/main/java/com/google/crypto/tink/mac:mac_config",
        "//src/main/java/com/google/crypto/tink/mac:mac_factory",
        "//src/main/java/com/google/crypto/tink/mac:mac_key_templates",
        "//src/main/java/com/google/crypto/tink/mac:mac_wrapper",
        "//src/main/java/com/google/crypto/tink/prf:hkdf_prf_key_manager",
        "//src/main/java/com/google/crypto/tink/prf:prf_config",
        "//src/main/java/com/google/crypto/tink/prf:prf_key_templates",
        "//src/main/java/com/google/crypto/tink/prf:prf_set",
        "//src/main/java/com/google/crypto/tink/prf:prf_set_wrapper",
        "//src/main/java/com/google/crypto/tink/signature:ecdsa_sign_key_manager",
        "//src/main/java/com/google/crypto/tink/signature:ecdsa_verify_key_manager",
        "//src/main/java/com/google/crypto/tink/signature:ed25519_private_key_manager",
        "//src/main/java/com/google/crypto/tink/signature:ed25519_public_key_manager",
        "//src/main/java/com/google/crypto/tink/signature:public_key_sign_factory",
        "//src/main/java/com/google/crypto/tink/signature:public_key_sign_wrapper",
        "//src/main/java/com/google/crypto/tink/signature:public_key_verify_factory",
        "//src/main/java/com/google/crypto/tink/signature:public_key_verify_wrapper",
        "//src/main/java/com/google/crypto/tink/signature:rsa_ssa_pkcs1_sign_key_manager",
        "//src/main/java/com/google/crypto/tink/signature:rsa_ssa_pkcs1_verify_key_manager",
        "//src/main/java/com/google/crypto/tink/signature:rsa_ssa_pss_sign_key_manager",
        "//src/main/java/com/google/crypto/tink/signature:rsa_ssa_pss_verify_key_manager",
        "//src/main/java/com/google/crypto/tink/signature:sig_util",
        "//src/main/java/com/google/crypto/tink/signature:signature_config",
        "//src/main/java/com/google/crypto/tink/signature:signature_key_templates",
        "//src/main/java/com/google/crypto/tink/signature:signature_pem_keyset_reader",
        "//src/main/java/com/google/crypto/tink/streamingaead:aes_ctr_hmac_streaming_key_manager",
        "//src/main/java/com/google/crypto/tink/streamingaead:aes_gcm_hkdf_streaming_key_manager",
        "//src/main/java/com/google/crypto/tink/streamingaead:streaming_aead_config",
        "//src/main/java/com/google/crypto/tink/streamingaead:streaming_aead_factory",
        "//src/main/java/com/google/crypto/tink/streamingaead:streaming_aead_key_templates",
        "//src/main/java/com/google/crypto/tink/streamingaead:streaming_aead_util",
        "//src/main/java/com/google/crypto/tink/streamingaead:streaming_aead_wrapper",
        "//src/main/java/com/google/crypto/tink/subtle:aes_cmac",
        "//src/main/java/com/google/crypto/tink/subtle:aes_ctr_hmac_streaming",
        "//src/main/java/com/google/crypto/tink/subtle:aes_ctr_jce_cipher",
        "//src/main/java/com/google/crypto/tink/subtle:aes_eax_jce",
        "//src/main/java/com/google/crypto/tink/subtle:aes_gcm_hkdf_streaming",
        "//src/main/java/com/google/crypto/tink/subtle:aes_gcm_jce",
        "//src/main/java/com/google/crypto/tink/subtle:aes_siv",
        "//src/main/java/com/google/crypto/tink/subtle:aes_util",
        "//src/main/java/com/google/crypto/tink/subtle:bytes",
        "//src/main/java/com/google/crypto/tink/subtle:cha_cha20",
        "//src/main/java/com/google/crypto/tink/subtle:cha_cha20_poly1305",
        "//src/main/java/com/google/crypto/tink/subtle:ecdsa_sign_jce",
        "//src/main/java/com/google/crypto/tink/subtle:ecdsa_verify_jce",
        "//src/main/java/com/google/crypto/tink/subtle:ecies_aead_hkdf_dem_helper",
        "//src/main/java/com/google/crypto/tink/subtle:ecies_aead_hkdf_hybrid_decrypt",
        "//src/main/java/com/google/crypto/tink/subtle:ecies_aead_hkdf_hybrid_encrypt",
        "//src/main/java/com/google/crypto/tink/subtle:ed25519_cluster",
        "//src/main/java/com/google/crypto/tink/subtle:ed25519_sign",
        "//src/main/java/com/google/crypto/tink/subtle:ed25519_verify",
        "//src/main/java/com/google/crypto/tink/subtle:elliptic_curves",
        "//src/main/java/com/google/crypto/tink/subtle:encrypt_then_authenticate",
        "//src/main/java/com/google/crypto/tink/subtle:enums",
        "//src/main/java/com/google/crypto/tink/subtle:field25519",
        "//src/main/java/com/google/crypto/tink/subtle:hex",
        "//src/main/java/com/google/crypto/tink/subtle:hkdf",
        "//src/main/java/com/google/crypto/tink/subtle:immutable_byte_array",
        "//src/main/java/com/google/crypto/tink/subtle:ind_cpa_cipher",
        "//src/main/java/com/google/crypto/tink/subtle:kwp",
        "//src/main/java/com/google/crypto/tink/subtle:pem_key_type",
        "//src/main/java/com/google/crypto/tink/subtle:poly1305",
        "//src/main/java/com/google/crypto/tink/subtle:prf_hmac_jce",
        "//src/main/java/com/google/crypto/tink/subtle:prf_mac",
        "//src/main/java/com/google/crypto/tink/subtle:random",
        "//src/main/java/com/google/crypto/tink/subtle:rewindable_readable_byte_channel",
        "//src/main/java/com/google/crypto/tink/subtle:rsa_ssa_pkcs1_sign_jce",
        "//src/main/java/com/google/crypto/tink/subtle:rsa_ssa_pkcs1_verify_jce",
        "//src/main/java/com/google/crypto/tink/subtle:rsa_ssa_pss_sign_jce",
        "//src/main/java/com/google/crypto/tink/subtle:rsa_ssa_pss_verify_jce",
        "//src/main/java/com/google/crypto/tink/subtle:subtle_util_cluster",
        "//src/main/java/com/google/crypto/tink/subtle:validators",
        "//src/main/java/com/google/crypto/tink/subtle:x25519",
        "//src/main/java/com/google/crypto/tink/subtle:x_cha_cha20",
        "//src/main/java/com/google/crypto/tink/subtle:x_cha_cha20_poly1305",
        "//src/main/java/com/google/crypto/tink/subtle/prf:hkdf_streaming_prf",
        "//src/main/java/com/google/crypto/tink/subtle/prf:prf_impl",
        "//src/main/java/com/google/crypto/tink/subtle/prf:streaming_prf",
        "//src/main/java/com/google/crypto/tink/testing:key_type_manager_test_util",
        "//src/main/java/com/google/crypto/tink/testing:streaming_test_util",
        "//src/main/java/com/google/crypto/tink/testing:test_util",
        "//src/main/java/com/google/crypto/tink/testing:wycheproof_test_util",
        "//src/main/java/com/google/crypto/tink/util:keys_downloader",
        "//src/main/java/com/google/crypto/tink/util:test_util",
        "@com_google_protobuf//:protobuf_javalite",
        "@maven//:com_amazonaws_aws_java_sdk_core",
        "@maven//:com_amazonaws_aws_java_sdk_kms",
        "@maven//:com_google_api_client_google_api_client",
        "@maven//:com_google_http_client_google_http_client",
        "@maven//:com_google_truth_truth",
        "@maven//:junit_junit",
        "@maven//:org_json_json",
        "@maven//:org_mockito_mockito_core",
    ],
)

# Anything in test_files will be a small sized test unless specified in an explicit category.
# Don't hesitate to increase the length when writing legitimately longer tests.
gen_java_test_rules(
    data = [
        "@tink_base//testdata:credentials",
        "@tink_base//testdata:ecies_keysets",
        "@wycheproof//testvectors:all",
    ],
    default_test_size = "small",
    # these tests are excluded when testing with bazel test ... or on Kokoro
    manual_tests = [
        "java/com/google/crypto/tink/subtle/AesGcmJceTest",
        "java/com/google/crypto/tink/subtle/AesGcmHkdfStreamingTest",
        # b/112019120
        "java/com/google/crypto/tink/subtle/RsaSsaPkcs1VerifyJceTest",
    ],
    medium_tests = [
        "java/com/google/crypto/tink/subtle/AesCtrHmacStreamingTest",
        "java/com/google/crypto/tink/subtle/AesGcmJceTest",
        "java/com/google/crypto/tink/hybrid/EciesAeadHkdfHybridDecryptTest",
    ],
    no_rbe_tests = [
        "java/com/google/crypto/tink/aead/KmsAeadKeyManagerTest",
        "java/com/google/crypto/tink/aead/KmsEnvelopeAeadKeyManagerTest",
    ],
    test_files = glob(
        [
            "**/*Test.java",
        ],
    ),
    deps = [
        ":generator_test",
    ],
)
